<Window x:Class="IPTVChannelManager.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:IPTVChannelManager"
        xmlns:common="clr-namespace:IPTVChannelManager.Common"
        mc:Ignorable="d"
        Icon="tv.ico"
        Title="Channel Manager" Height="800" Width="1600">
    <Window.Resources>
        <DataTemplate x:Key="ChannelItemTemplate">
            <Border>
                <Grid VerticalAlignment="Center" Margin="0">
                    <Grid.Style>
                        <Style TargetType="Grid">
                            <Setter Property="Background" Value="Transparent"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding Ignore}" Value="True">
                                    <Setter Property="Background" Value="Orange"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Grid.Style>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="40"/>
                        <ColumnDefinition Width="150"/>
                        <ColumnDefinition Width="40"/>
                        <ColumnDefinition Width="150"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="80"/>
                        <ColumnDefinition Width="80"/>
                        <ColumnDefinition Width="60"/>
                    </Grid.ColumnDefinitions>
                    <Border Background="Black">
                        <Image Source="{Binding LogoUrl}" Width="40" Height="20">
                            <Image.ToolTip>
                                <Border Background="Black">
                                    <Image Source="{Binding LogoUrl}"/>
                                </Border>
                            </Image.ToolTip>
                        </Image>
                    </Border>
                    <TextBox Grid.Column="1" VerticalAlignment="Center" TextWrapping="NoWrap" Text="{Binding Logo, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Margin="4 0"/>
                    <TextBox Grid.Column="2" VerticalAlignment="Center" TextWrapping="NoWrap" Text="{Binding Id, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Margin="4 0"/>
                    <TextBox Grid.Column="3" VerticalAlignment="Center" TextWrapping="NoWrap" Text="{Binding Name, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Margin="4 0"/>
                    <TextBlock Grid.Column="4" VerticalAlignment="Center" TextWrapping="NoWrap" Text="{Binding Url, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Margin="4 0"/>

                    <ComboBox Grid.Column="5" VerticalAlignment="Center"
                              ItemsSource="{Binding DataContext.ChannelGroups, RelativeSource={RelativeSource AncestorType=Window}}" 
                              SelectedItem="{Binding Group, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>

                    <CheckBox Grid.Column="6" Checked="IgnoreCheckBoxUpdated" Unchecked="IgnoreCheckBoxUpdated" IsChecked="{Binding Ignore, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Content="Ignore" VerticalAlignment="Center" Margin="5 0" HorizontalAlignment="Center"/>
                    <Button Grid.Column="7" Content="Play" VerticalContentAlignment="Center" Padding="5 0" Margin="5 0"
                            Command="{Binding DataContext.PlayCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                            CommandParameter="{Binding}"/>
                </Grid>
            </Border>
        </DataTemplate>

        <DataTemplate x:Key="ListHeader">
            <Grid Background="Transparent">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="40"/>
                    <ColumnDefinition Width="150"/>
                    <ColumnDefinition Width="40"/>
                    <ColumnDefinition Width="150"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="80"/>
                    <ColumnDefinition Width="140"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="20"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <TextBlock Grid.Column="0" Text="Logo" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                <TextBlock Grid.Column="1" Text="Logo ID" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                <TextBlock Grid.Column="2" Text="ID" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                <TextBlock Grid.Column="3" Text="Name" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                <TextBlock Grid.Column="4" Text="Address" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                <TextBlock Grid.Column="5" Text="Group" HorizontalAlignment="Left" VerticalAlignment="Center"/>
                <Border Grid.Column="6"/>
            </Grid>
        </DataTemplate>

        <DataTemplate x:Key="ChannelListItemTemplate">
            <DockPanel >
                <Button Content="X" Margin="0" Width="30" Padding="5 0" VerticalContentAlignment="Center"
                        Command="{Binding DataContext.RemoveDBChannelCommand, RelativeSource={RelativeSource AncestorType=Window}}" CommandParameter="{Binding}"/>
                <ContentControl DockPanel.Dock="Right" Content="{Binding .}" ContentTemplate="{StaticResource ChannelItemTemplate}" HorizontalAlignment="Stretch"/>
            </DockPanel>
        </DataTemplate>
        
        <DataTemplate x:Key="NewChannelItemTemplate">
            <DockPanel Background="LightSeaGreen">
                <Button Content="&lt;-" Margin="0" Width="30" Padding="5 0" VerticalContentAlignment="Center"
                        Command="{Binding DataContext.AddCommand, RelativeSource={RelativeSource AncestorType=Window}}" CommandParameter="{Binding}"/>
                <ContentControl DockPanel.Dock="Right" Content="{Binding .}" ContentTemplate="{StaticResource ChannelItemTemplate}" HorizontalAlignment="Stretch"/>
            </DockPanel>
        </DataTemplate>

        <DataTemplate x:Key="OldChannelItemTemplate">
            <DockPanel Background="OrangeRed">
                <Button Content="-&gt;" Margin="0" Width="30" Padding="5 0" VerticalContentAlignment="Center"
                        Command="{Binding DataContext.RemoveCommand, RelativeSource={RelativeSource AncestorType=Window}}" CommandParameter="{Binding}"/>
                <ContentControl DockPanel.Dock="Right" Content="{Binding .}" ContentTemplate="{StaticResource ChannelItemTemplate}" HorizontalAlignment="Stretch"/>
            </DockPanel>
        </DataTemplate>
    </Window.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <DockPanel Grid.ColumnSpan="2" LastChildFill="True">
            <StackPanel Orientation="Horizontal" Margin="2" DockPanel.Dock="Right">
                <CheckBox Content="Process custom host" IsChecked="{Binding ProcessCustomHost, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" VerticalAlignment="Center" Margin="2"/>
                <Button Content="Export to M3U..." Margin="2" Padding="10 2" Command="{Binding ExportToM3uCommand}"/>
                <Button Content="Export to TXT..." Margin="2" Padding="10 2" Command="{Binding ExportToTxtCommand}"/>
            </StackPanel>
            <StackPanel Orientation="Horizontal" Margin="2">
                <Button Content="Import New Channels..." Margin="2" Padding="10 2" Command="{Binding ImportChannelsCommand}"/>
                <Button Content="Save Channels to DB" Margin="2" Padding="10 2" Command="{Binding SaveChannelsDBCommand}"/>
                <Button Content="Reload DB Channels" Margin="2" Padding="10 2" Command="{Binding ReloadChannelsDBCommand}"/>
                <Button Content="Setting..." Margin="2" Padding="10 2" Command="{Binding ShowSettingCommand}"/>
            </StackPanel>
        </DockPanel>

        <GroupBox Grid.Row="1" Margin="2" BorderThickness="1">
            <GroupBox.Header>
                <StackPanel Orientation="Horizontal">
                    <TextBlock>
                        <Run Text="Channels"/>
                        <Run Text="{Binding Count, Mode=OneWay}"/>
                    </TextBlock>
                    <TextBox Text="{Binding FilterText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="100" Margin="5 0 0 0" VerticalAlignment="Center"/>
                </StackPanel>
            </GroupBox.Header>
            <DockPanel>
                <Border DockPanel.Dock="Top" Background="#AAA" Padding="36 0 0 0">
                    <ContentControl ContentTemplate="{StaticResource ListHeader}"/>
                </Border>
                <ListBox ItemsSource="{Binding Channels}" BorderThickness="0" HorizontalContentAlignment="Stretch"
                         ItemTemplate="{StaticResource ChannelListItemTemplate}" VirtualizingPanel.VirtualizationMode="Standard" Background="#DDD"
                         common:ItemsControlFilter.By="{Binding Filter, Mode=OneWay}">
                </ListBox>
            </DockPanel>
        </GroupBox>

        <Grid Grid.Row="1" Grid.Column="1">
            <Grid.RowDefinitions>
                <RowDefinition/>
                <RowDefinition/>
            </Grid.RowDefinitions>
            <GroupBox Margin="2" BorderThickness="1">
                <GroupBox.Header>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock>
                            <Run Text="New Channels"/>
                            <Run Text="{Binding NewChannels.Count, Mode=OneWay, StringFormat=({0})}"/>
                        </TextBlock>
                        <Button Content="&lt;&lt;-" Command="{Binding AddAllCommand}" Margin="5 0 2 0" Width="40" Padding="5 0" VerticalContentAlignment="Center"/>
                    </StackPanel>
                </GroupBox.Header>
                <DockPanel>
                    <Border DockPanel.Dock="Top" Background="#AAA" Padding="36 0 0 0">
                        <ContentControl ContentTemplate="{StaticResource ListHeader}"/>
                    </Border>
                    <ListBox ItemsSource="{Binding NewChannels}" BorderThickness="0" HorizontalContentAlignment="Stretch"
                             ItemTemplate="{StaticResource NewChannelItemTemplate}" VirtualizingPanel.VirtualizationMode="Standard" Background="#DDD">
                    </ListBox>
                </DockPanel>
            </GroupBox>
            <GroupBox Grid.Row="1" Margin="2" BorderThickness="1">
                <GroupBox.Header>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock>
                            <Run Text="Obsolete Channels"/>
                            <Run Text="{Binding OldChannels.Count, Mode=OneWay, StringFormat=({0})}"/>
                        </TextBlock>
                        <Button Content="-&gt;&gt;" Command="{Binding RemoveAllCommand}" Margin="5 0 2 0" Width="40" Padding="5 0" VerticalContentAlignment="Center"/>
                    </StackPanel>
                </GroupBox.Header>
                <DockPanel>
                    <Border DockPanel.Dock="Top" Background="#AAA" Padding="36 0 0 0">
                        <ContentControl ContentTemplate="{StaticResource ListHeader}"/>
                    </Border>
                    <ListBox ItemsSource="{Binding OldChannels}" BorderThickness="0" HorizontalContentAlignment="Stretch"
                             ItemTemplate="{StaticResource OldChannelItemTemplate}" VirtualizingPanel.VirtualizationMode="Standard" Background="#DDD">
                    </ListBox>
                </DockPanel>
            </GroupBox>
        </Grid>
    </Grid>
</Window>
